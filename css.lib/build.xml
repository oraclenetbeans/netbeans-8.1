<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="netbeans" name="css.lib">
    <description>Builds, tests, and runs the project org.netbeans.modules.css.lib</description>
    <import file="../nbbuild/templates/projectized.xml"/>

    <target name="generate-antlr-parser">
        <fail unless="antlr.jar">You must set antlr.jar property pointing to the antlr-x.x-complete.jar</fail>

        <java classname="org.antlr.Tool" fork="true" failonerror="true">
            <!-- use -debug option so the generated parser allows to register an DebugEventListener and hence allow to build a parse tree -->
            <arg value="-debug"/>
            <arg value="-verbose"/>
            <arg value="-o"/>
            <arg path="src/org/netbeans/modules/css/lib"/>
            <arg path="src/org/netbeans/modules/css/lib/Css3.g"/>
            <classpath>
                <pathelement path="${classpath}"/>
                <pathelement location="${antlr.jar}"/>
            </classpath>
        </java>

        <!-- delete the not necessary generated file -->
        <delete verbose="false" file="src/org/netbeans/modules/css/lib/Css3.tokens" failonerror="false"/>

        <!-- delete files generated by ANTLR Works when debugging the grammar -->
        <delete verbose="false" dir="src/org/netbeans/modules/css/lib/output" failonerror="false"/>

    </target>

    <target name="test-preinit">
        <!-- from some reason the test build fails with:
        java.io.IOException: /Volumes/Mercurial/web-main/nbbuild/netbeans/extra/modules/org-netbeans-modules-css-lib.jar is not the same as /Volumes/Mercurial/web-main/nbbuild/build/testdist/extralibs/org-netbeans-modules-css-lib.jar; will not overwrite
        -->
        <delete verbose="true" file="../nbbuild/build/testdist/extralibs/org-netbeans-modules-css-lib.jar"/>
    </target>


</project>
